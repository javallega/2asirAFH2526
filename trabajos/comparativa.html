<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Comparativa de IAs por pregunta y plataforma</title>
  <style>
    :root {
      --color-bg: #0f172a;
      --color-card: #020617;
      --color-card-soft: #020617;
      --color-accent-1: #38bdf8; /* Qwen */
      --color-accent-2: #22c55e; /* Granite */
      --color-accent-3: #f97316; /* Gema */
      --color-accent-4: #e11d48; /* Alleani */
      --color-text: #e5e7eb;
      --color-muted: #9ca3af;
      --radius-lg: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--color-text);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 24px;
    }

    .page {
      width: 100%;
      max-width: 1200px;
    }

    h1 {
      font-size: 26px;
      margin-bottom: 8px;
    }

    h2 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    h3 {
      font-size: 16px;
      margin: 12px 0 6px;
    }

    p {
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 6px;
    }

    ul {
      margin-left: 18px;
      margin-bottom: 8px;
    }

    li {
      font-size: 14px;
      margin-bottom: 4px;
    }

    blockquote {
      border-left: 3px solid #4b5563;
      margin: 8px 0;
      padding-left: 10px;
      font-size: 14px;
      color: var(--color-muted);
    }

    .subtitle-main {
      font-size: 14px;
      color: var(--color-muted);
      margin-bottom: 18px;
      max-width: 820px;
      line-height: 1.5;
    }

    /* Índice como barra de botones centrada */
    #indice {
      margin-bottom: 20px;
    }

    .section-card {
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.12), transparent 55%);
      background-color: var(--color-card-soft);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow:
        0 18px 40px rgba(15, 23, 42, 0.7),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      padding: 16px 18px 18px;
      margin-bottom: 18px;
      position: relative;
      overflow: hidden;
    }

    .section-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top right,
          rgba(56, 189, 248, 0.12),
          transparent 60%);
      opacity: 0.7;
      pointer-events: none;
    }

    .section-inner {
      position: relative;
      z-index: 1;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .section-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--color-muted);
      background: rgba(15, 23, 42, 0.85);
    }

    .index-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      justify-content: center;
    }

    .index-btn {
      border: none;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--color-muted);
      font-size: 13px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, transform 0.1s;
      white-space: nowrap;
    }

    .index-btn:hover {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #0b1120;
      transform: translateY(-1px);
    }

    /* Tarjetas de pregunta en sección 3 */
    .question-card {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at top left,
                  rgba(15, 23, 42, 0.7),
                  rgba(15, 23, 42, 0.95));
    }

    .question-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .question-tag {
      display: inline-block;
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--color-muted);
    }

    .question-body {
      font-size: 13px;
      margin-top: 2px;
    }

    .question-answer {
      font-size: 13px;
      margin-top: 4px;
      color: var(--color-muted);
    }

    /* Toggles comunes */
    .metric-toggle,
    .platform-toggle,
    .question-toggle {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 8px 12px 0;
      padding: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .metric-btn,
    .platform-btn,
    .question-btn {
      border: none;
      padding: 6px 14px;
      border-radius: 999px;
      background: transparent;
      color: var(--color-muted);
      font-size: 13px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      white-space: nowrap;
    }

    .metric-btn.active {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #0b1120;
      font-weight: 500;
    }

    .platform-btn.active {
      background: linear-gradient(135deg, #4f46e5, #0ea5e9);
      color: #0b1120;
      font-weight: 500;
    }

    .question-btn.active {
      background: linear-gradient(135deg, #f97316, #e11d48);
      color: #0b1120;
      font-weight: 500;
    }

    /* Paneles y gráficas */
    .panel {
      background: linear-gradient(135deg, #020617, #030712);
      border-radius: 20px;
      padding: 18px 18px 18px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow:
        0 18px 40px rgba(15, 23, 42, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      position: relative;
      overflow: hidden;
      margin-bottom: 14px;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left,
          rgba(56, 189, 248, 0.14),
          transparent 60%);
      opacity: 0.9;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.55);
      color: var(--color-muted);
      font-size: 11px;
      margin-bottom: 8px;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--color-accent-1);
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.8);
    }

    .panel-title {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .panel-subtitle {
      font-size: 12px;
      color: var(--color-muted);
      margin-bottom: 8px;
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: var(--color-muted);
      margin-bottom: 8px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .legend-swatch {
      width: 10px;
      height: 10px;
      border-radius: 4px;
    }

    .chart-wrapper {
      background: radial-gradient(circle at top, #020617, #020617 40%, #000 100%);
      border-radius: 14px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      padding: 14px 14px 18px;
      position: relative;
      overflow: hidden;
    }

    .chart-grid {
      position: absolute;
      inset: 0;
      padding: 14px 16px 24px 46px;
      pointer-events: none;
    }

    .chart-grid-line {
      position: absolute;
      left: 46px;
      right: 0;
      border-top: 1px dashed rgba(55, 65, 81, 0.85);
      font-size: 11px;
      color: rgba(148, 163, 184, 0.9);
    }

    .chart-grid-line span {
      position: absolute;
      left: -44px;
      top: -8px;
      text-align: right;
      width: 40px;
    }

    .chart-body {
      position: relative;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 10px;
      height: 210px;
      padding: 0 10px 4px 46px;
      z-index: 1;
    }

    .x-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      gap: 4px;
    }

    .x-bars {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 4px;
      width: 100%;
    }

    .bar {
      flex: 1;
      max-width: 24px;
      position: relative;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    [data-chart="coste"] .bar {
      max-width: 32px;
    }

    .bar-inner {
      width: 100%;
      border-radius: 999px;
      background: linear-gradient(to top, #0b1120, #020617);
      border: 1px solid rgba(15, 23, 42, 0.9);
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .bar-fill {
      width: 100%;
      border-radius: inherit;
      background: currentColor;
      box-shadow: 0 0 4px rgba(15, 23, 42, 0.6);
      height: 0;
      transition: height 0.6s ease-out;
    }

    .bar-value {
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      color: var(--color-text);
      background: rgba(15, 23, 42, 0.95);
      padding: 1px 4px;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      font-variant-numeric: tabular-nums;
      opacity: 0;
      transition: opacity 0.4s ease-out 0.3s;
      white-space: nowrap;
      pointer-events: none;
    }

    .x-label {
      font-size: 11px;
      color: var(--color-muted);
      text-align: center;
    }

    .chart-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--color-muted);
    }

    .platform-panel {
      display: none;
    }

    .platform-panel.active {
      display: block;
    }

    @media (max-width: 768px) {
      .index-bar {
        border-radius: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Comparativa por pregunta y plataforma</h1>
    <p class="subtitle-main">
      Estudio de cuatro modelos de IA en LM Studio, evaluando calidad de respuesta,
      tokens por segundo y tiempo del primer token en Mac mini (Apple) y Windows 11,
      para una serie de problemas de lógica, matemáticas y generación de contenido.
    </p>

    <!-- Índice -->
    <section id="indice">
      <div class="section-card">
        <div class="section-inner">
          <div class="section-header">
            <h2>Índice</h2>
            <span class="section-pill">Navegación rápida</span>
          </div>
          <div class="index-bar">
            <button class="index-btn" data-target="#intro">1. Introducción</button>
            <button class="index-btn" data-target="#ias">2. IAs comparadas</button>
            <button class="index-btn" data-target="#problemas">3. Problemas planteados</button>
            <button class="index-btn" data-target="#coste">4. Coste de generación</button>
            <button class="index-btn" data-target="#graficas">5. Gráficas comparativas</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 1. Introducción -->
    <section id="intro" class="section-card">
      <div class="section-inner">
        <div class="section-header">
          <h2>1. Introducción</h2>
          <span class="section-pill">Contexto del estudio</span>
        </div>
        <p>
          Se han comparado 4 inteligencias artificiales dentro de LM Studio con una serie
          de problemas de distinta índole y complejidad, para evaluar si sus respuestas
          y su razonamiento son correctos. Se les ha realizado una batería de preguntas
          tanto en un Mac mini (Apple) como en un equipo con Windows 11 con tarjeta
          gráfica Nvidia, midiendo calidad de respuesta y rendimiento.
        </p>
      </div>
    </section>

    <!-- 2. IAs comparadas -->
    <section id="ias" class="section-card">
      <div class="section-inner">
        <div class="section-header">
          <h2>2. IAs comparadas</h2>
          <span class="section-pill">Modelos evaluados</span>
        </div>
        <p>Las inteligencias artificiales analizadas son las siguientes:</p>
        <ul>
          <li>Qwen 3&nbsp;4B, creada por Alibaba Cloud, con 4 mil millones de parámetros.</li>
          <li>Granite 4H Tiny, creada por IBM, con 4 mil millones de parámetros.</li>
          <li>Gemma 3&nbsp;n 4B, creada por Google, con 4 mil millones de parámetros.</li>
          <li>Allenai/olmocr 2 7B, creada por el Allen Institute for AI (AI2), con 7 mil millones de parámetros.</li>
        </ul>
      </div>
    </section>

    <!-- 3. Problemas planteados -->
    <section id="problemas" class="section-card">
      <div class="section-inner">
        <div class="section-header">
          <h2>3. Problemas planteados</h2>
          <span class="section-pill">Conjunto de pruebas</span>
        </div>
        <p>
          Se han comparado estas 4 inteligencias artificiales en LM Studio con una serie
          de preguntas y problemas de lógica, matemáticas y razonamiento, de dificultad
          media y alta.
        </p>

        <div class="question-card">
          <div class="question-title">
            <span class="question-tag">P1</span>
            Problema del prisionero
          </div>
          <div class="question-body">
            Un prisionero se encuentra ante tres guardianes: uno siempre dice la verdad,
            uno siempre miente y uno responde aleatoriamente. Puede hacer dos preguntas
            de sí/no para averiguar qué puerta le lleva a la libertad.
          </div>
          <div class="question-answer">
            <strong>Solución esperada:</strong> con solo 2 preguntas se puede determinar la puerta correcta.
          </div>
        </div>

        <div class="question-card">
          <div class="question-title">
            <span class="question-tag">P2</span>
            Secuencia matemática
          </div>
          <div class="question-body">
            Se define una secuencia \((a_1, a_2, …)\) con \(a_1 = 1\) y \(a_n = n - a_{a_{n-1}}\) para \(n &gt; 1\).
            Se pide el valor de \(a_{2025}\).
          </div>
          <div class="question-answer">
            <strong>Respuesta esperada:</strong> 1350.
          </div>
        </div>

        <div class="question-card">
          <div class="question-title">
            <span class="question-tag">P3</span>
            Lógica infinita del interruptor
          </div>
          <div class="question-body">
            Un interruptor cambia de estado cada vez en intervalos que se reducen a la mitad,
            completando infinitos cambios en un minuto. Se pregunta si al final queda en ON u OFF.
          </div>
          <div class="question-answer">
            <strong>Solución esperada:</strong> no se puede determinar con certeza el estado final.
          </div>
        </div>

        <div class="question-card">
          <div class="question-title">
            <span class="question-tag">P4</span>
            Problema del ascensor
          </div>
          <div class="question-body">
            Un hombre vive en el décimo piso: baja siempre hasta la planta baja, pero al subir
            solo llega en ascensor al séptimo y camina el resto. Se pregunta por qué.
          </div>
          <div class="question-answer">
            <strong>Solución esperada:</strong> es bajo y no alcanza el botón del décimo piso.
          </div>
        </div>

        <div class="question-card">
          <div class="question-title">
            <span class="question-tag">P5</span>
            Problema aritmético de ovejas
          </div>
          <div class="question-body">
            Un granjero tiene 17 ovejas y se mueren 9. Se pregunta cuántas quedan.
          </div>
          <div class="question-answer">
            <strong>Solución esperada:</strong> quedan 8 ovejas vivas y 9 muertas.
          </div>
        </div>

        <div class="question-card">
          <div class="question-title">
            <span class="question-tag">P6</span>
            Adivinanza del 8
          </div>
          <div class="question-body">
            “Si me tumbas soy todo, si me cortas por la cintura me quedo en nada. ¿Qué soy?”
          </div>
          <div class="question-answer">
            <strong>Respuesta esperada:</strong> el número 8; tumbado representa el símbolo de infinito.
          </div>
        </div>
      </div>
    </section>

    <!-- 4. Coste -->
    <section id="coste" class="section-card">
      <div class="section-inner">
        <div class="section-header">
          <h2>4. Coste de generación de contenido</h2>
          <span class="section-pill">Tokens generados</span>
        </div>
        <p>
          Para la siguiente petición se ha medido el coste en número de tokens generados
          por cada modelo en cada plataforma:
        </p>
        <blockquote>
          “Dame una explicación detallada de cómo se daría una clase de trigonometría
          de segundo de bachillerato de ciencias puras.”
        </blockquote>
        <p>
          La gráfica siguiente muestra los tokens generados por cada modelo en Mac mini
          y Windows 11. Valores (tokens generados): Qwen 3&nbsp;4B (2325, 2600),
          Granite 4H Tiny (601, 906), Gemma 3&nbsp;n 4B (1937, 1771) y Allenai/olmocr 2 7B (534, 782).
        </p>

        <section class="panel">
          <div class="panel-inner">
            <div class="badge">
              <span class="dot"></span>
              Coste en tokens por modelo
            </div>
            <h3 class="panel-title">Tokens generados por IA y plataforma</h3>
            <p class="panel-subtitle">
              Barras agrupadas por modelo. Mac mini y Windows 11 en cada grupo.
            </p>

            <div class="legend">
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-1);"></span>
                Mac mini
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-3);"></span>
                Windows 11
              </span>
            </div>

            <div class="chart-wrapper">
              <div class="chart-grid" data-grid="coste"></div>
              <div class="chart-body" data-chart="coste"></div>
              <div class="chart-footer">
                <span>Eje Y: tokens generados</span>
                <span>Eje X: modelos IA</span>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- 5. Gráficas comparativas -->
    <section id="graficas" class="section-card">
      <div class="section-inner">
        <div class="section-header">
          <h2>5. Gráficas comparativas</h2>
          <span class="section-pill">Rendimiento y calidad</span>
        </div>
        <p>
          A continuación se muestran las gráficas comparativas basadas en tokens por segundo,
          tiempo del primer token y calidad de respuesta para cada pregunta y cada modelo.
          Puedes elegir la métrica, la plataforma y una pregunta concreta o verlas todas.
        </p>

        <div class="question-toggle">
          <button class="question-btn active" data-question="all">Todas</button>
          <button class="question-btn" data-question="P1">Prisionero</button>
          <button class="question-btn" data-question="P2">Secuencia</button>
          <button class="question-btn" data-question="P3">Interruptor</button>
          <button class="question-btn" data-question="P4">Ascensor</button>
          <button class="question-btn" data-question="P5">Ovejas</button>
          <button class="question-btn" data-question="P6">Adivinanza 8</button>
        </div>

        <div class="metric-toggle">
          <button class="metric-btn active" data-metric="tps">Tokens por segundo</button>
          <button class="metric-btn" data-metric="ttft">Tiempo primer token</button>
        </div>

        <div class="platform-toggle">
          <button class="platform-btn active" data-platform="apple">Apple (Mac mini)</button>
          <button class="platform-btn" data-platform="windows">Windows 11</button>
        </div>

        <section class="panel platform-panel active" id="panel-apple">
          <div class="panel-inner">
            <div class="badge">
              <span class="dot"></span>
              Plataforma: Apple (Mac mini)
            </div>
            <h3 class="panel-title">Resultados por pregunta (Apple)</h3>
            <p class="panel-subtitle">
              Barras agrupadas por pregunta. Una barra por modelo IA.
            </p>

            <div class="legend">
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-1);"></span>
                Qwen 3‑4B
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-2);"></span>
                Granite‑4H‑tiny7B
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-3);"></span>
                Gema‑3ne4b
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-4);"></span>
                Alleani‑olmo
              </span>
            </div>

            <div class="chart-wrapper">
              <div class="chart-grid" data-grid="apple"></div>
              <div class="chart-body" data-chart="apple"></div>
              <div class="chart-footer">
                <span id="y-label-apple">Eje Y: tokens por segundo</span>
                <span>Eje X: Preguntas 1–6</span>
              </div>
            </div>
          </div>
        </section>

        <section class="panel platform-panel" id="panel-windows">
          <div class="panel-inner">
            <div class="badge">
              <span class="dot"></span>
              Plataforma: Windows 11
            </div>
            <h3 class="panel-title">Resultados por pregunta (Windows)</h3>
            <p class="panel-subtitle">
              Barras agrupadas por pregunta. Una barra por modelo IA.
            </p>

            <div class="legend">
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-1);"></span>
                Qwen 3‑4B
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-2);"></span>
                Granite‑4H‑tiny7B
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-3);"></span>
                Gema‑3ne4b
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-4);"></span>
                Alleani‑olmo
              </span>
            </div>

            <div class="chart-wrapper">
              <div class="chart-grid" data-grid="windows"></div>
              <div class="chart-body" data-chart="windows"></div>
              <div class="chart-footer">
                <span id="y-label-windows">Eje Y: tokens por segundo</span>
                <span>Eje X: Preguntas 1–6</span>
              </div>
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="panel-inner">
            <div class="badge">
              <span class="dot"></span>
              Calidad de respuesta
            </div>
            <h3 class="panel-title">Calidad por pregunta y modelo (0–100)</h3>
            <p class="panel-subtitle">
              Valores aproximados basados en la evaluación de calidad para cada IA en cada pregunta.
            </p>

            <div class="legend">
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-1);"></span>
                Qwen 3‑4B
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-2);"></span>
                Granite‑4H‑tiny7B
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-3);"></span>
                Gema‑3ne4b
              </span>
              <span class="legend-item">
                <span class="legend-swatch" style="background: var(--color-accent-4);"></span>
                Alleani‑olmo
              </span>
            </div>

            <div class="chart-wrapper">
              <div class="chart-grid" data-grid="calidad"></div>
              <div class="chart-body" data-chart="calidad"></div>
              <div class="chart-footer">
                <span>Eje Y: puntuación de calidad (0–100)</span>
                <span>Eje X: Preguntas 1–6</span>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>
  </div>

  <script>
    // Scroll suave desde el índice
    document.querySelectorAll(".index-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-target");
        const el = document.querySelector(target);
        if (el) {
          el.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    });

    const preguntas = ["P1", "P2", "P3", "P4", "P5", "P6"];

    const datos = {
      apple: {
        tps: {
          labels: preguntas,
          series: {
            "Qwen 3-4B": [37.91, 50.08, 37.87, 36.34, 38.01, 37.39],
            "Granite-4H-tiny7B": [43.48, 42.21, 42.21, 43.54, 42.11, 43.27],
            "Gema-3ne4b": [16.68, 18.62, 18.61, 18.86, 18.96, 18.79],
            "Alleani-olmo": [104.3, 135.07, 165.6, 102.54, 99.2, 96.07]
          }
        },
        ttft: {
          labels: preguntas,
          series: {
            "Qwen 3-4B": [1.35, 1.28, 1.33, 0.96, 1.03, 0.56],
            "Granite-4H-tiny7B": [0.38, 1.74, 0.33, 0.21, 0.23, 0.2],
            "Gema-3ne4b": [1.02, 2.22, 0.56, 0.76, 0.45, 0.47],
            "Alleani-olmo": [1.04, 0.98, 1.27, 0.17, 0.09, 0.32]
          }
        }
      },
      windows: {
        tps: {
          labels: preguntas,
          series: {
            "Qwen 3-4B": [104, 135.07, 106.56, 102.54, 99.2, 96.07],
            "Granite-4H-tiny7B": [67.69, 57.8, 70.23, 74.24, 70.7, 71.26],
            "Gema-3ne4b": [42.69, 72.08, 72.26, 40.68, 39.67, 41.05],
            "Alleani-olmo": [70.84, 37.7, 77.4, 71.1, 78.27, 90.57]
          }
        },
        ttft: {
          labels: preguntas,
          series: {
            "Qwen 3-4B": [0.28, 0.26, 0.25, 0.04, 0.11, 0.04],
            "Granite-4H-tiny7B": [0.34, 0.18, 0.07, 0.05, 0.09, 0.05],
            "Gema-3ne4b": [0.13, 0.17, 0.06, 0.06, 0.06, 0.17],
            "Alleani-olmo": [0.08, 0.17, 0.08, 0.03, 0.04, 0.14]
          }
        }
      },
      calidad: {
        labels: preguntas,
        series: {
          "Qwen 3-4B": [0, 0, 0, 50, 0, 0],
          "Granite-4H-tiny7B": [63, 10, 30, 95, 75, 5],
          "Gema-3ne4b": [100, 50, 50, 100, 100, 50],
          "Alleani-olmo": [100, 10, 50, 100, 10, 10]
        }
      },
      coste: {
        labels: ["Qwen 3-4B", "Granite 4H Tiny", "Gemma 3n 4B", "Allenai/olmocr 2 7B"],
        mac: [2325, 601, 1937, 534],
        win: [2600, 906, 1771, 782]
      }
    };

    const colores = {
      "Qwen 3-4B": "var(--color-accent-1)",
      "Granite-4H-tiny7B": "var(--color-accent-2)",
      "Gema-3ne4b": "var(--color-accent-3)",
      "Alleani-olmo": "var(--color-accent-4)"
    };

    const MAX_HEIGHT_PX = 200;
    const MIN_BAR_RATIO = 0.05;

    function calcularMaxValor(dataset) {
      let max = 0;
      for (const model in dataset.series) {
        dataset.series[model].forEach(v => {
          if (v > max) max = v;
        });
      }
      return max * 1.05;
    }

    function crearGrid(gridElement, maxValor, metric, isCoste = false, isCalidad = false) {
      gridElement.innerHTML = "";
      const steps = 4;
      for (let i = 0; i <= steps; i++) {
        const linea = document.createElement("div");
        linea.className = "chart-grid-line";
        const bottom = (i / steps) * 100;
        linea.style.bottom = bottom + "%";

        const etiqueta = document.createElement("span");
        let valor = maxValor * i / steps;
        if (isCalidad || isCoste) {
          etiqueta.textContent = Math.round(valor);
        } else {
          etiqueta.textContent = metric === "tps"
            ? Math.round(valor)
            : valor.toFixed(2);
        }
        linea.appendChild(etiqueta);
        gridElement.appendChild(linea);
      }
    }

    function renderChart(container, gridElement, dataset, metric, questionIndex = null) {
      let labels = dataset.labels;
      let series = dataset.series;

      if (questionIndex !== null && questionIndex >= 0) {
        labels = [dataset.labels[questionIndex]];
        const filtradas = {};
        Object.keys(series).forEach(m => {
          filtradas[m] = [series[m][questionIndex]];
        });
        series = filtradas;
      }

      const datasetFiltrado = { labels, series };
      const maxValor = calcularMaxValor(datasetFiltrado);
      crearGrid(gridElement, maxValor, metric);
      container.innerHTML = "";

      const modelos = Object.keys(series);

      labels.forEach((label, index) => {
        const group = document.createElement("div");
        group.className = "x-group";

        const barsWrapper = document.createElement("div");
        barsWrapper.className = "x-bars";

        modelos.forEach((modelo) => {
          const valor = series[modelo][index];

          const bar = document.createElement("div");
          bar.className = "bar";
          bar.dataset.value = valor;
          bar.dataset.max = maxValor;
          bar.dataset.modelo = modelo;

          const barInner = document.createElement("div");
          barInner.className = "bar-inner";

          const fill = document.createElement("div");
          fill.className = "bar-fill";
          fill.style.color = colores[modelo];

          const valueLabel = document.createElement("div");
          valueLabel.className = "bar-value";
          valueLabel.textContent =
            metric === "tps"
              ? valor.toFixed(2) + " t/s"
              : valor.toFixed(2) + " s";

          barInner.appendChild(fill);
          barInner.appendChild(valueLabel);
          bar.appendChild(barInner);

          bar.title = modelo + ": " + valueLabel.textContent;

          barsWrapper.appendChild(bar);
        });

        const xLabel = document.createElement("div");
        xLabel.className = "x-label";
        xLabel.textContent = label;

        group.appendChild(barsWrapper);
        group.appendChild(xLabel);
        container.appendChild(group);
      });

      animateChart(container);
    }

    function renderCostChart(container, gridElement, dataset) {
      const maxValor = Math.max(...dataset.mac, ...dataset.win) * 1.05;
      crearGrid(gridElement, maxValor, "tps", true);
      container.innerHTML = "";

      const labels = dataset.labels;

      labels.forEach((label, index) => {
        const group = document.createElement("div");
        group.className = "x-group";

        const barsWrapper = document.createElement("div");
        barsWrapper.className = "x-bars";

        const macValue = dataset.mac[index];
        const winValue = dataset.win[index];

        const barMac = document.createElement("div");
        barMac.className = "bar";
        barMac.dataset.value = macValue;
        barMac.dataset.max = maxValor;

        const barInnerMac = document.createElement("div");
        barInnerMac.className = "bar-inner";

        const fillMac = document.createElement("div");
        fillMac.className = "bar-fill";
        fillMac.style.color = "var(--color-accent-1)";

        const valueLabelMac = document.createElement("div");
        valueLabelMac.className = "bar-value";
        valueLabelMac.textContent = macValue + " tkn";

        barInnerMac.appendChild(fillMac);
        barInnerMac.appendChild(valueLabelMac);
        barMac.appendChild(barInnerMac);

        barMac.title = label + " (Mac mini): " + valueLabelMac.textContent;

        const barWin = document.createElement("div");
        barWin.className = "bar";
        barWin.dataset.value = winValue;
        barWin.dataset.max = maxValor;

        const barInnerWin = document.createElement("div");
        barInnerWin.className = "bar-inner";

        const fillWin = document.createElement("div");
        fillWin.className = "bar-fill";
        fillWin.style.color = "var(--color-accent-3)";

        const valueLabelWin = document.createElement("div");
        valueLabelWin.className = "bar-value";
        valueLabelWin.textContent = winValue + " tkn";

        barInnerWin.appendChild(fillWin);
        barInnerWin.appendChild(valueLabelWin);
        barWin.appendChild(barInnerWin);

        barWin.title = label + " (Windows 11): " + valueLabelWin.textContent;

        barsWrapper.appendChild(barMac);
        barsWrapper.appendChild(barWin);

        const xLabel = document.createElement("div");
        xLabel.className = "x-label";
        xLabel.textContent = label;

        group.appendChild(barsWrapper);
        group.appendChild(xLabel);
        container.appendChild(group);
      });

      animateChart(container);
    }

    function renderQualityChart(container, gridElement, dataset) {
      const maxValor = 100;
      crearGrid(gridElement, maxValor, "tps", false, true);
      container.innerHTML = "";

      const labels = dataset.labels;
      const modelos = Object.keys(dataset.series);

      labels.forEach((label, index) => {
        const group = document.createElement("div");
        group.className = "x-group";

        const barsWrapper = document.createElement("div");
        barsWrapper.className = "x-bars";

        modelos.forEach((modelo) => {
          const valor = dataset.series[modelo][index];

          const bar = document.createElement("div");
          bar.className = "bar";
          bar.dataset.value = valor;
          bar.dataset.max = maxValor;
          bar.dataset.modelo = modelo;

          const barInner = document.createElement("div");
          barInner.className = "bar-inner";

          const fill = document.createElement("div");
          fill.className = "bar-fill";
          fill.style.color = colores[modelo];

          const valueLabel = document.createElement("div");
          valueLabel.className = "bar-value";
          valueLabel.textContent = Math.round(valor) + " %";

          barInner.appendChild(fill);
          barInner.appendChild(valueLabel);
          bar.appendChild(barInner);

          bar.title = modelo + ": " + valueLabel.textContent;

          barsWrapper.appendChild(bar);
        });

        const xLabel = document.createElement("div");
        xLabel.className = "x-label";
        xLabel.textContent = label;

        group.appendChild(barsWrapper);
        group.appendChild(xLabel);
        container.appendChild(group);
      });

      animateChart(container, true);
    }

    function animateChart(chartBody, isQuality = false) {
      const bars = chartBody.querySelectorAll(".bar");
      bars.forEach((bar, index) => {
        const value = Number(bar.dataset.value || 0);
        const max = Number(bar.dataset.max || 1);
        const fill = bar.querySelector(".bar-fill");
        const valueLabel = bar.querySelector(".bar-value");

        let ratio = Math.max(0, Math.min(value / max, 1));
        if (isQuality || bar.closest('[data-chart="coste"]')) {
          if (ratio === 0) ratio = MIN_BAR_RATIO;
        }

        const targetHeight = ratio * MAX_HEIGHT_PX;

        fill.style.height = "0px";
        valueLabel.style.opacity = "0";

        const delay = 60 * index;
        setTimeout(() => {
          fill.style.height = targetHeight + "px";
          valueLabel.style.opacity = "1";
        }, delay);
      });
    }

    function actualizarYLabels(metric) {
      const yApple = document.getElementById("y-label-apple");
      const yWindows = document.getElementById("y-label-windows");
      if (!yApple || !yWindows) return;
      if (metric === "tps") {
        yApple.textContent = "Eje Y: tokens por segundo";
        yWindows.textContent = "Eje Y: tokens por segundo";
      } else {
        yApple.textContent = "Eje Y: tiempo del primer token (s)";
        yWindows.textContent = "Eje Y: tiempo del primer token (s)";
      }
    }

    function inicializarGraficas() {
      const costeChart = document.querySelector('[data-chart="coste"]');
      const costeGrid = document.querySelector('[data-grid="coste"]');
      renderCostChart(costeChart, costeGrid, datos.coste);

      const calidadChart = document.querySelector('[data-chart="calidad"]');
      const calidadGrid = document.querySelector('[data-grid="calidad"]');
      renderQualityChart(calidadChart, calidadGrid, datos.calidad);

      const chartApple = document.querySelector('[data-chart="apple"]');
      const chartWindows = document.querySelector('[data-chart="windows"]');
      const gridApple = document.querySelector('[data-grid="apple"]');
      const gridWindows = document.querySelector('[data-grid="windows"]');

      let metricActual = "tps";
      let plataformaActual = "apple";
      let questionActual = "all";

      function renderPlataforma() {
        const indexPregunta = questionActual === "all"
          ? null
          : preguntas.indexOf(questionActual);

        if (plataformaActual === "apple") {
          renderChart(chartApple, gridApple, datos.apple[metricActual], metricActual, indexPregunta);
        } else {
          renderChart(chartWindows, gridWindows, datos.windows[metricActual], metricActual, indexPregunta);
        }
        actualizarYLabels(metricActual);
      }

      renderPlataforma();

      const metricButtons = document.querySelectorAll(".metric-btn");
      metricButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const metric = btn.dataset.metric;
          if (metric === metricActual) return;

          metricButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          metricActual = metric;
          renderPlataforma();
        });
      });

      const platformButtons = document.querySelectorAll(".platform-btn");
      const platformPanels = document.querySelectorAll(".platform-panel");

      platformButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const plat = btn.dataset.platform;
          if (plat === plataformaActual) return;

          platformButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          plataformaActual = plat;

          platformPanels.forEach(p => p.classList.remove("active"));
          const panelId = plataformaActual === "apple" ? "panel-apple" : "panel-windows";
          document.getElementById(panelId).classList.add("active");

          renderPlataforma();
        });
      });

      const questionButtons = document.querySelectorAll(".question-btn");
      questionButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const q = btn.dataset.question;
          if (q === questionActual) return;

          questionButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          questionActual = q;
          renderPlataforma();
        });
      });
    }

    window.addEventListener("DOMContentLoaded", inicializarGraficas);
  </script>
</body>
</html>
